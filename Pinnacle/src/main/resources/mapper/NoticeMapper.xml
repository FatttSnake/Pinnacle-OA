<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cfive.pinnacle.mapper.NoticeMapper">
    <!-- 根据公告id查公告信息及发布人、公告类别名   -->
    <select id="selectByNoticeId" resultMap="NoticeByIdResultMap" parameterType="long">
        select *
        from t_user u,
             t_notice n,
             t_notice_type type
        where u.id = n.sender_id
          and type.id = n.type_id
          and n.id = #{nid}
          and n.deleted = 0
          and n.old = 0
    </select>
    <resultMap id="NoticeByIdResultMap" type="notice" autoMapping="true">
        <association property="sender" javaType="user" autoMapping="true"/>
        <association property="noticeType" javaType="noticeType" autoMapping="true"/>
    </resultMap>

    <!--  查询所有公告  -->
    <select id="selectAllNotice" resultMap="NoticeAllResultMap">
        select u.id    uid,
               username,
               n.id    nid,
               title,
               content,
               type_id,
               sender_id,
               create_time,
               send_time,
               end_time,
               priority,
               top,
               modify_time,
               origin_id,
               type.id typeId,
               name,
               type.enable
        from t_notice n
                 left join t_notice_type type on n.type_id = type.id
                 left join t_user u on n.sender_id = u.id
        where n.deleted = 0
          and n.old = 0
        order by create_time desc
    </select>
    <resultMap id="NoticeAllResultMap" type="notice" autoMapping="true">
        <id property="id" column="nid"/>
        <association property="sender" javaType="user" autoMapping="true">
            <id property="id" column="uid"/>
        </association>
        <association property="noticeType" javaType="noticeType" autoMapping="true">
            <id property="id" column="typeId"/>
        </association>
    </resultMap>
    <!--    模糊查询-->
    <select id="selectByCond" resultMap="NoticeAllResultMap">
        select u.id uid,
        username,
        n.id nid,
        title,
        content,
        type_id,
        sender_id,
        create_time,
        send_time,
        end_time,
        priority,
        top,
        modify_time,
        origin_id,
        type.id typeId,
        type.name,
        type.enable
        from t_notice n
        left join t_notice_type type on n.type_id = type.id
        left join t_user u on n.sender_id = u.id
        <where>
            <if test="null!=title and title!=''">
                and instr(title,#{title})&gt;0
            </if>
            <if test="null!=type and type!=''">
                and instr(type.name,#{type})&gt;0
            </if>
            <if test="null!=startTime">
                and send_time &gt;= #{startTime}
            </if>
            <if test="null !=endTime">
                and end_time &lt; #{endTime}
            </if>
            and n.deleted = 0
            and n.old = 0
        </where>
    </select>
</mapper>
